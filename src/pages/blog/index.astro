---
import path from "path";
import Base from "~/layouts/Base.astro";
import BlogPosts from "~/components/BlogPosts";
import { Frontmatter, preparePosts } from "~/lib/blog";
import GithubSlugger from "github-slugger";

const content = await Astro.glob<Frontmatter>("../../../content/**/*.md");
const posts = preparePosts(content);

const slugger = new GithubSlugger();

// TODO Build a search index for content and tags
const blogposts = posts.map((p) => {
  const slug = p.frontmatter.slug || slugger.slug(p.frontmatter.title);
  if (!p.frontmatter.slug) p.frontmatter.slug = slug;
  return {
    url: p.url || path.join(Astro.url.pathname, slug),
    frontmatter: p.frontmatter,
  };
});
---

<Base title="Harry Brown | Blog" description="The ramblings of a madman.">
  <main>
    <header>
      <h1>Blog</h1>
    </header>
    <section>
      <BlogPosts posts={blogposts} />
    </section>
  </main>
</Base>

<style is:global>
  ul {
    list-style: none;
  }
</style>
