---
import "../font/SourceCodePro/sourcecodepro.css";
import "../styles/global.css";

import Font from "~/font/SourceCodePro/SourceCodePro-latin.woff2";
import StarsImg from "~/img/stars-compressed.webp";
import Meta, { MetaProps } from "../components/Meta.astro";
import StarBackground from "../components/StarBackground.astro";
import ToggleSwitch from "../components/ToggleSwitch.astro";
import LoadTheme from "~/components/LoadTheme.astro";
import GoofyImg from "~/img/goofy.jpg";

export interface Props {
  title: string;
  description: string;
  lang?: string;
  head?: MetaProps;
}

const { lang = "en", title, description, head } = Astro.props;
const themeId = "tt";
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <LoadTheme key="theme" button={themeId} />
    <style is:global>
      body {
        font-family: "Source Code Pro", mono, "Liberation Mono", monospace;
        font-size: 16px;
        margin-right: auto;
        margin-left: auto;
        margin-bottom: 2em;
        max-width: 750px;
      }
    </style>
    <Meta title={title} description={description} image={GoofyImg} {...head} />
    <link rel="preload" href={StarsImg} as="image" type="image/webp" />
    <link rel="preload" href={Font} as="font" type="font/woff2" crossorigin />
  </head>
  <body>
    <StarBackground />
    <ToggleSwitch id={themeId} checked={false} size="60px" />
    <slot />
    <script>
      import type { Modal } from "~/lib/modal";
      import { listener } from "~/lib/keyboard-shortcuts";
      import { Theme } from "~/lib/theme";

      const help = document.getElementById("help-window") as Modal | null;
      const toggle = document.getElementById("tt") as HTMLInputElement;
      document.addEventListener(
        "keydown",
        listener(() => window.themeToggle(toggle), help)
      );
      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", ({ matches: isDark }) => {
          window.setTheme(isDark ? Theme.Dark : Theme.Light, toggle);
        });
    </script>
  </body>
</html>
